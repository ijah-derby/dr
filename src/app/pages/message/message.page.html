<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button mode="md" defaultHref="messages"></ion-back-button>
    </ion-buttons>
    <ion-title>{{title}}</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="viewUser(userId)">
        <ion-icon name="information-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [scrollEvents]="true" #content>
  <div class="messages" #contentArea>
    <p class="center" *ngIf="startIndex > 0"><span tappable (click)="loadPreviousMessages()">Load previous
        messages</span></p>
    <div *ngFor="let message of messagesToShow; let i = index;">
      <div *ngIf="isSender(message)" class="chatbox right sender" (click)="openMsgOption(message.id, i)">
        <div *ngIf="message.type == 'text'">
          <!-- <div class="reply-view-header" *ngIf="message.replyToMessage">
            <p [innerHTML]="getMessage(message.replyToMessage)"></p>
          </div> -->
          <p style="margin:0" [innerHTML]="getMessage(message.message)"></p>
        </div>
        <div *ngIf="message.type == 'location'" [innerHtml]="message.message"></div>
        <div *ngIf="message.type == 'image'">
          <img tappable (click)="enlargeImage(message.message)" src="{{message.message}}" (load)="scrollBottom()" />
        </div>
        <div *ngIf="message.type == 'video'">
          <video controls width="100%">
            <source src="{{message.message}}" type="video/mp4">
          </video>
        </div>
        <span>{{message.date | DateFormat}}</span>
      </div>

      <ion-item-sliding *ngIf="!isSender(message)" id="slidingItem{{message.id}}">
        <ion-item-options side="start">
          <ion-item-option style="display: none;">Reply</ion-item-option>
        </ion-item-options>
        <div class="chatbox left" style="padding: 3px;">
          <ion-item style="border-radius: 5px;border: 3px solid rgb(238, 238, 238);" lines="none">
            <ion-label>
              <div *ngIf="message.type == 'text'">
                <div class="reply-view-header" *ngIf="message.replyToMessage">
                  <p [innerHTML]="getMessage(message.replyToMessage)"></p>
                </div>
                <p style="margin:0" [innerHTML]="getMessage(message.message)"></p>
              </div>
              <div *ngIf="message.type == 'location'" [innerHtml]="message.message"></div>
              <div *ngIf="message.type == 'image'">
                <img tappable (click)="enlargeImage(message.message)" src="{{message.message}}" (load)="scrollBottom()" />
              </div>
              <div *ngIf="message.type == 'video'">
                <video controls width="100%">
                  <source src="{{message.message}}" type="video/mp4">
                </video>
              </div>
              <span>{{message.date | DateFormat}}</span>
            </ion-label>
          </ion-item>
        </div>
      </ion-item-sliding>

    </div>

  </div>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-item lines="none" style="--background: #eeeeee7d;" *ngIf="replyMessage.message">
      <ion-label>{{replyMessage.message}}</ion-label>
      <ion-icon name="close" slot="end" (click)="replyMessage.message = null;replyMessage.id = null;"></ion-icon>
    </ion-item>
    <ion-item lines="none">
      <ion-button slot="start" fill="clear" (click)="attach()">
        <ion-icon src="../../../assets/icons/attach.svg"></ion-icon>
      </ion-button>
      <ion-textarea #input style="height: 100%;" autoGrow="true" rows="1" placeholder="Type your message"
        [(ngModel)]="message"></ion-textarea>
      <ion-button slot="end" color="primary" fill="clear" (click)="send('text')" [disabled]="!message">
        send
      </ion-button>
    </ion-item>
  </ion-toolbar>
</ion-footer>
<input
  hidden
  #fileInputButton
  type="file"
  (change)="detectFiles($event)"
  multiple
/>
<input hidden #videoInputButton type="file" (change)="detectVideo($event)" />